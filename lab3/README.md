# Расширенный SMTP Клиент для Linux/WSL

Расширенный SMTP клиент, написанный на C, который работает в средах Linux/WSL с поддержкой TLS/SSL шифрования, MIME вложений и расширенного интерфейса командной строки.

## Особенности

- Устанавливает TCP-соединение с SMTP-серверами на портах 25 и 587
- Реализует полный SMTP диалог согласно RFC 5321
- Поддерживает TLS/SSL шифрование с STARTTLS (порт 587)
- Реализует аутентификацию AUTH LOGIN/PLAIN
- Создает MIME multipart сообщения с файловыми вложениями
- Base64 кодирование для вложений
- Расширенный интерфейс командной строки с getopt
- Модульная архитектура с отдельными компонентами
- Чистое управление ресурсами и обработкой ошибок

## Зависимости

- Среда Linux или WSL
- Компилятор GCC
- Библиотеки разработки OpenSSL (`libssl-dev`)
- Сетевое подключение к SMTP-серверу

Для установки библиотек разработки OpenSSL в Ubuntu/Debian:
```bash
sudo apt-get update
sudo apt-get install libssl-dev
```

## Сборка

Для компиляции SMTP клиента просто запустите:

Для подробного руководства по использованию см. файл `USAGE_GUIDE_RU.md` в корневом каталоге проекта.

```bash
./build.sh
```

Или вручную с помощью gcc:
```bash
gcc -Wall -Wextra -std=c11 -O2 -DUSE_OPENSSL -o smtp_client smtp_client.c smtp_utils.c mime_utils.c tls_utils.c -lssl -lcrypto
```

## Использование

```bash
./smtp_client [опции]
```

### Основные опции:

- `-s, --server SERVER` - адрес SMTP-сервера
- `-p, --port PORT` - порт SMTP-сервера (25, 587)
- `-f, --from EMAIL` - адрес отправителя
- `-t, --to EMAIL` - адрес получателя
- `-j, --subject SUBJECT` - тема письма
- `-b, --body TEXT` - текст письма или путь к файлу
- `-a, --attachment FILE` - файл-вложение (можно использовать несколько раз)
- `-l, --login USERNAME` - логин для аутентификации
- `-w, --password PASS` - пароль для аутентификации
- `--tls, --ssl` - использовать TLS/SSL шифрование
- `-v, --verbose` - подробный вывод SMTP-диалога
- `-h, --help` - показать справку

### Примеры:

1. Базовое письмо:
```bash
./smtp_client -s smtp.mail.ru -p 25 -f sender@mail.ru -t recipient@mail.ru -j "Test" -b "Hello"
```

2. Защищенное письмо с аутентификацией:
```bash
./smtp_client -s smtp.gmail.com -p 587 --tls -l user@gmail.com -w "pass" -f user@gmail.com -t recipient@mail.ru -j "TLS Test" -b "Secure message"
```

3. Письмо с несколькими вложениями:
```bash
./smtp_client -s smtp.yandex.ru -p 587 --tls -l your_email@yandex.ru -w "your_app_password" -f your_email@yandex.ru -t recipient@example.com -j "Files" -b "See attachments" -a document.pdf -a photo.jpg -a data.txt
```

ВАЖНО: Для работы с реальными SMTP-серверами (Gmail, Yandex, Mail.ru) необходимо:
- Использовать действительный email-адрес и пароль приложения (не обычный пароль)
- Включить в настройках безопасности разрешение на использование ненадежных приложений
- Убедиться, что файлы вложений существуют в текущей директории

## Поддерживаемые функции

### SMTP с TLS/SSL (Порт 587, STARTTLS)
- Модифицированный клиент для работы с защищенными SMTP-серверами
- Реализация команды STARTTLS и переход на шифрованное соединение
- Использование библиотеки OpenSSL для установки TLS-соединения
- Добавлена аутентификация по логину и паролю (AUTH LOGIN/PLAIN)
- Поддержка как обычного SMTP (порт 25), так и SMTP+TLS (порт 587)

### MIME-сообщения с вложениями
- Формирование MIME-сообщений с несколькими частями (multipart/mixed)
- Кодирование файлов-вложений в base64
- Поддержка различных типов вложений: картинки (image/jpeg, image/png), документы (application/pdf, text/plain)
- Корректные MIME-заголовки: Content-Type, Content-Transfer-Encoding, Content-Disposition
- Обработка больших файлов (чтение и отправка по частям)

### Расширенный интерфейс командной строки
- Гибкий парсинг аргументов с GNU-style длинными опциями
- Поддержка нескольких вложений
- Поддержка текста письма или файла с текстом
- Режим подробного вывода для отладки

### Реализация
- Модульная архитектура: отдельные модули для базового SMTP, TLS, MIME
- Чистая обработка ошибок на всех уровнях
- Поддержка больших файлов (буферизация, прогресс-отображение)
- Корректное освобождение всех ресурсов (память, сокеты, SSL)
- Валидация входных данных (адреса email, файлы)

## Тестирование

Клиент протестирован с:
- Локальным тестовым сервером (например, с помощью python -m smtpd -c DebuggingServer -n localhost:1025)
- Публичными серверами (Gmail, Yandex, Mail.ru)
- Проверкой корректного отображения в почтовых клиентах (Gmail, Outlook, Thunderbird)

## Устранение неполадок

Если вы сталкиваетесь с ошибками линковки с -lssl -lcrypto:
- Убедитесь, что установлены библиотеки разработки OpenSSL
- Или используйте сборку без поддержки OpenSSL